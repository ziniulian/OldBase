LZR.HTML5.loadJs([LZR.HTML5.jsPath+"HTML5/Canvas/LayerManager.js"]);
LZR.HTML5.Canvas.LayerMgrEys=function(a){this.canvas=a.canvas;this.layerMgr=a.layerMgr;this.ctx=this.canvas.getContext("2d");this.lmEdge=new LZR.Util.Graphics.Edge({width:this.layerMgr.max.w,height:this.layerMgr.max.h});this.max=new LZR.Util.Graphics.Edge({width:this.canvas.width,height:this.canvas.height});this.max.addChild(this.lmEdge);this.ctrl=new LZR.HTML5.Util.MouseDropController(this.canvas);this.showColor="#cccccc";this.backColor=null;this.colorAlpha=0.3;this.layers=[];this.constant={}};
LZR.HTML5.Canvas.LayerMgrEys.prototype.className="LZR.HTML5.Canvas.LayerMgrEys";LZR.HTML5.Canvas.LayerMgrEys.prototype.version="0.0.0";LZR.HTML5.Canvas.LayerMgrEys.prototype.init=function(){this.lmEdge.rrByParent();this.layers=this.layerMgr.layers;this.lmEdge.alineInParent("center");this.constant.scale=this.lmEdge.scale();this.ctrl.state===this.ctrl.STATE.UNABLE&&(this.ctrl.noMid=!0,this.ctrl.noRight=!0,this.ctrl.noClick=!0,this.ctrl.enable())};
LZR.HTML5.Canvas.LayerMgrEys.prototype.flush=function(){var a=this.lmEdge.left,b=this.lmEdge.top,c=this.lmEdge.w,d=this.lmEdge.h;this.ctx.globalAlpha=1;this.ctx.fillStyle="#eeeeee";this.ctx.fillRect(a,b,c,d);for(var e=0;e<this.layers.length;e++)this.layers[e].draw(this.ctx,a,b,c,d);this.autoFlushMax(this.ctx,a,b,c,d);this.ctx.globalAlpha=this.colorAlpha;this.backColor&&(this.ctx.fillStyle=this.backColor,this.ctx.fillRect(a,b,c,d));a+=this.layerMgr.s.left*this.constant.scale;b+=this.layerMgr.s.top*
this.constant.scale;c=this.layerMgr.s.w*this.constant.scale;d=this.layerMgr.s.h*this.constant.scale;this.backColor&&(this.ctx.globalCompositeOperation="lighter");this.ctx.fillStyle=this.showColor;this.ctx.fillRect(a,b,c,d);this.ctx.globalCompositeOperation="source-over";this.autoFlush(this.ctx,a,b,c,d)};LZR.HTML5.Canvas.LayerMgrEys.prototype.autoFlushMax=function(){};LZR.HTML5.Canvas.LayerMgrEys.prototype.autoFlush=function(){};
LZR.HTML5.Canvas.LayerMgrEys.prototype.ctrlUpdate=function(){var a,b;if(this.ctrl.state==this.ctrl.STATE.LEFT)a=(this.ctrl.leftEnd.x-this.ctrl.leftStart.x)/this.constant.scale,b=(this.ctrl.leftEnd.y-this.ctrl.leftStart.y)/this.constant.scale,this.ctrl.leftStart=LZR.HTML5.Util.clone(this.ctrl.leftEnd),this.layerMgr.pan(a,b);else if(0!==this.ctrl.wheelValue){var c=-this.ctrl.wheelValue;this.ctrl.wheelValue=0;b=LZR.HTML5.Util.getDomPositionForDocument(this.canvas);a=(this.ctrl.currentPage.x-b.left-this.lmEdge.left)/
this.constant.scale-this.layerMgr.s.left;b=(this.ctrl.currentPage.y-b.top-this.lmEdge.top)/this.constant.scale-this.layerMgr.s.top;this.layerMgr.zoom(c,a,b)}};LZR.HTML5.Canvas.LayerMgrEys.prototype.ctrlEnable=function(){this.ctrl.state===this.ctrl.STATE.UNABLE&&this.ctrl.enable()};LZR.HTML5.Canvas.LayerMgrEys.prototype.ctrlDisable=function(){this.ctrl.state!==this.ctrl.STATE.UNABLE&&this.ctrl.disable()};
LZR.HTML5.Canvas.LayerMgrEys.prototype.resize=function(){LZR.HTML5.Util.mateWidth(this.canvas);this.init()};
