window.JSON||LZR.HTML5.loadJs([LZR.HTML5.jsPath+"util/expand/json2.js"]);LZR.HTML5.loadJs([LZR.HTML5.jsPath+"util/CallBacks.js"]);LZR.HTML5.Bp.Util.CatchImgByWebsocket=function(a){this.mod=this.area=this.num=null;this.sort=1;this.results=this.ws=this.url=null;this.state=this.STATE.none;this.resultType=this.REULT_TYPE.url;this.event={get:new LZR.Util.CallBacks(this),close:new LZR.Util.CallBacks(this)};a&&LZR.setObj(this,a)};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.className="LZR.HTML5.Bp.Util.CatchImgByWebsocket";
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.version="0.0.2";LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.STATE={none:0,ok:1,ing:2,over:3,end:4,redo:5};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.REULT_TYPE={url:{typ:"picURL",fld:"URL",pre:"http://192.168.1.101/imgServer/figure/figure/"},base64:{typ:"picContent",fld:"Byte64",pre:"data:image/jpeg;base64,"}};LZR.HTML5.loadJs([LZR.HTML5.jsPath+"HTML5/Bp/Util/CatchImgByWebsocket/Result.js"]);
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.open=function(){switch(this.state){case this.STATE.ing:this.state=this.STATE.redo;this.ws.close();break;case this.STATE.none:case this.STATE.over:case this.STATE.end:this.state=this.STATE.ok,this.results=[],this.ws=new WebSocket(this.url),this.ws.onopen=LZR.bind(this,this.handleOnOpen),this.ws.onclose=LZR.bind(this,this.handleOnClose),this.ws.onerror=LZR.bind(this,this.handleOnError),this.ws.onmessage=LZR.bind(this,function(a){this.handleOnMessage(JSON.parse(a.data))})}};
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.close=function(){switch(this.state){case this.STATE.ing:this.state=this.STATE.end;this.ws.close();break;case this.STATE.redo:this.state=this.STATE.end}};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.setUrlPre=function(a){this.REULT_TYPE.url.pre=a};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.setEventObj=function(a){for(var b in this.event)this.event[b].obj=a};
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.handleOnOpen=function(){this.state===this.STATE.ok&&(this.state=this.STATE.ing,this.ws.send(JSON.stringify(this.createSQL())))};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.handleOnMessage=function(a){switch(a.state){case "0":var b=new LZR.HTML5.Bp.Util.CatchImgByWebsocket.Result;b.tim=a.picTime;b.ret=this.resultType.pre+a[this.resultType.fld];this.onGetOneResponse(b)&&this.results.push(b)}};
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.handleOnClose=function(){switch(this.state){case this.STATE.redo:this.state=this.STATE.none;this.open();break;case this.STATE.ing:this.state=this.STATE.over;this.onClose(this.results,this.state);break;case this.STATE.end:this.onClose(this.results,this.state)}};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.handleOnError=function(){};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.onGetOneResponse=function(a){return this.event.get.execute(a)};
LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.onClose=function(a,b){return this.event.close.execute(a,b)};LZR.HTML5.Bp.Util.CatchImgByWebsocket.prototype.createSQL=function(){};
