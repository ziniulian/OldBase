<html>
	<head>
		<title>testOrbit</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script src="../../../../LZR.js"></script>

		<style>
			.map {
				width: 100%;
				height: 80%;
			}
			.def {
				font-size: 20px;
				margin: 10px;
				color:#ccc;

			}
			.down {
				color:blue;
			}
			.title {
				font-family: 微软雅黑;
				font-size: 50px;
				/*width: 50px;*/
				/*height: 50px;*/
				background-color: yellow;
			}
		</style>

		<script>
			var ob;
			function init() {
				LZR.HTML5.jsPath = LZR.HTML5.upPath(4);
				LZR.HTML5.loadJs([
					LZR.HTML5.jsPath + "HTML5/Bp/OpenLayers/Orbit.js",
					LZR.HTML5.jsPath + "HTML5/util/Selector.js"
				]);
				var data = [{"code":17018,"result":[{"zlevel":1,"grdCollection":[{"values":[969.87682542229334,46.48080265854783],"time":"2015-07-03 23","x":114.35409,"y":37.9097,"u":-2.375234378414147,"v":3.4921486686321281},{"values":[976.39906853646607,41.362630923485511],"time":"2015-07-03 22","x":114.4993374794103,"y":37.80241399260963,"u":-4.7145805725404486,"v":3.1301611169004357},{"values":[990.933041141674,30.628263281640653],"time":"2015-07-03 21","x":114.71811107029484,"y":37.728479268052716,"u":-5.9748607734014456,"v":1.4248153921706488},{"values":[995.6503947985783,21.237961360550734],"time":"2015-07-03 20","x":114.9601568977112,"y":37.702757553085029,"u":-5.8557794300084316,"v":0.14891073244535766},{"values":[998.5032762503987,17.797343497939682],"time":"2015-07-03 19","x":115.18018883034425,"y":37.722581804119493,"u":-4.8959975508057765,"v":-1.3862248072011019},{"values":[999.48275218365,16.384640982272987],"time":"2015-07-03 18","x":115.36454691429078,"y":37.782075988466609,"u":-4.10535387046942,"v":-2.2980226796302934},{"values":[999.0486045316859,15.776248032423045],"time":"2015-07-03 17","x":115.52834500306999,"y":37.869268395270325,"u":-3.8827071937462776,"v":-3.095478459499688},{"values":[998.9467658269574,15.848637690364306],"time":"2015-07-03 16","x":115.68461829627742,"y":37.9788605917139,"u":-3.7270391690335947,"v":-3.6811942997737015},{"values":[999.71926487248641,16.018876194332368],"time":"2015-07-03 15","x":115.8328799288539,"y":38.104647863188404,"u":-3.4801888829131014,"v":-4.0953325417768349},{"values":[1000.4523691189474,16.564063225324979],"time":"2015-07-03 14","x":115.97431979871921,"y":38.239067088136643,"u":-3.3827544757268675,"v":-4.2139400230485542},{"values":[1001.1846757751508,17.389408798567317],"time":"2015-07-03 13","x":116.11589804534198,"y":38.374844096957375,"u":-3.4504624419247092,"v":-4.4202453619851561},{"values":[1001.9541956198771,18.754101037885949],"time":"2015-07-03 12","x":116.26711024639087,"y":38.518679996997093,"u":-3.8583510650310542,"v":-4.4715245838507736},{"values":[1002.574191894563,21.338663108933151],"time":"2015-07-03 11","x":116.42601561577773,"y":38.669166826456653,"u":-3.80622701195625,"v":-4.83175387423562},{"values":[1002.8808611061503,25.073920282728331],"time":"2015-07-03 10","x":116.59446223198007,"y":38.817663975745006,"u":-4.3016803883727643,"v":-4.3494359715919231},{"values":[1002.8817423719354,23.243848679932086],"time":"2015-07-03 09","x":116.78660068279741,"y":38.956630658653765,"u":-4.9285190039065334,"v":-4.2452447162832723},{"values":[1002.5480066860454,21.434149729761483],"time":"2015-07-03 08","x":116.98824366446003,"y":39.094989217186061,"u":-4.7393289167320862,"v":-4.31286361868405},{"values":[1002.7586189002822,19.777815509385213],"time":"2015-07-03 07","x":117.19027190538237,"y":39.235328253360663,"u":-4.9276844951308716,"v":-4.367644563083835},{"values":[1003.0732182278152,22.209318040679861],"time":"2015-07-03 06","x":117.38919808594251,"y":39.388921636702079,"u":-4.5700259177731164,"v":-5.1313615752196506},{"values":[1002.6646446947212,20.474913985017167],"time":"2015-07-03 05","x":117.56466838318468,"y":39.5675086386735,"u":-3.7863089831252079,"v":-5.9093700252169024},{"values":[995.183342345614,20.148386769371548],"time":"2015-07-03 04","x":117.71976335104709,"y":39.7583894034317,"u":-3.5793308073068708,"v":-5.8890641941738622},{"values":[987.30801944747475,14.683947597884028],"time":"2015-07-03 03","x":117.85990761158087,"y":39.952372742606329,"u":-3.0574989112663169,"v":-6.0998776166749895},{"values":[973.5100115563281,14.084224487013255],"time":"2015-07-03 02","x":117.97935274889758,"y":40.151649863612242,"u":-2.5825664016885552,"v":-6.2146812942931531},{"values":[960.17546545321272,14.69321702317853],"time":"2015-07-03 01","x":118.07127393054628,"y":40.345317791328405,"u":-1.7454469917127544,"v":-5.7518187003218957},{"values":[950.05026203378407,13.559994254841373],"time":"2015-07-03 00","x":118.13793834901998,"y":40.520684193360069,"u":-1.3852019644227063,"v":-5.0830035214933238}]},{"zlevel":2,"grdCollection":[{"values":[957.98464324923748,30.838118466141857],"time":"2015-07-03 23","x":114.35409,"y":37.9097,"u":-6.5168835050582476,"v":6.0176435161974009},{"values":[976.56269797753612,24.908930574037718],"time":"2015-07-03 22","x":114.68044246855555,"y":37.736259166884892,"u":-9.4272676370397548,"v":4.6691782757299132},{"values":[985.40216667117431,21.912726554067742],"time":"2015-07-03 21","x":115.07703553914183,"y":37.627139820228656,"u":-9.9770173483370463,"v":2.030840189558532},{"values":[987.37619376389216,20.091793851861812],"time":"2015-07-03 20","x":115.46043769864413,"y":37.596243165480956,"u":-8.7896584467393311,"v":-0.16045810662138271},{"values":[986.2051399475987,18.962804010848831],"time":"2015-07-03 19","x":115.77912931737968,"y":37.62300187926607,"u":-6.8039833752785341,"v":-1.5190833173327931},{"values":[986.46834612061912,18.639289184564138],"time":"2015-07-03 18","x":116.03445657879053,"y":37.689254666442189,"u":-5.6780965593823538,"v":-2.5908133828406736},{"values":[986.80754750760218,19.45756203576429],"time":"2015-07-03 17","x":116.26782992317291,"y":37.781879730489514,"u":-5.7164714943979558,"v":-3.1454996308047045},{"values":[987.40841139391409,18.668476345516723],"time":"2015-07-03 16","x":116.49622631806866,"y":37.895105201884846,"u":-5.4179930934745029,"v":-3.8628583743505054},{"values":[988.45881427668974,18.024202152573537],"time":"2015-07-03 15","x":116.71817136308285,"y":38.018936439110007,"u":-5.3837395018824159,"v":-3.7999480126665932},{"values":[989.195464172684,18.718950032679889],"time":"2015-07-03 14","x":116.94451145965203,"y":38.144334298709708,"u":-5.6130183191047704,"v":-3.9601690106196834},{"values":[989.98814670358661,16.108238083656573],"time":"2015-07-03 13","x":117.18822374543026,"y":38.266055382788721,"u":-6.2079844617172393,"v":-3.5749586415888883},{"values":[990.502144990784,11.524510004202815],"time":"2015-07-03 12","x":117.47466015051768,"y":38.380499607674473,"u":-7.6633809954347942,"v":-3.5165742845540318},{"values":[990.84483401509476,10.431831194292435],"time":"2015-07-03 11","x":117.81517840889613,"y":38.500479833637748,"u":-8.7996306434898912,"v":-3.9258665967812627},{"values":[990.91799451862437,8.2571292989224929],"time":"2015-07-03 10","x":118.19834986866424,"y":38.639128718900267,"u":-9.6898118898898176,"v":-4.67799717237615},{"values":[990.49504627136344,8.6984447164518031],"time":"2015-07-03 09","x":118.59558899951195,"y":38.806846689333831,"u":-9.4335147866017657,"v":-5.7245909496966236},{"values":[990.03415580389935,9.3690425676554856],"time":"2015-07-03 08","x":118.97299244297164,"y":39.006285566430627,"u":-8.6839572473955258,"v":-6.6336282815146976},{"values":[990.16588117447964,9.8051020663692743],"time":"2015-07-03 07","x":119.31616742400419,"y":39.225662128764718,"u":-7.7391612306060953,"v":-6.9498420277944772},{"values":[990.33340733617922,9.9493871076336973],"time":"2015-07-03 06","x":119.61442411921571,"y":39.457814207211143,"u":-6.4870127309778542,"v":-7.4153128487023068},{"values":[987.15119584950708,10.118341939146831],"time":"2015-07-03 05","x":119.85537406325049,"y":39.705836032584308,"u":-4.9647126396553309,"v":-7.9221061037695462},{"values":[982.917008986187,10.332768527693553],"time":"2015-07-03 04","x":120.03766713873578,"y":39.963935754500092,"u":-3.6667156039040725,"v":-8.0313544218622575},{"values":[978.7552961849143,10.570046279695818],"time":"2015-07-03 03","x":120.17371879768818,"y":40.220058380640644,"u":-2.7510245788497474,"v":-7.7960818194840895},{"values":[974.24010389939156,9.8068996881636377],"time":"2015-07-03 02","x":120.29081797842422,"y":40.467255782221912,"u":-2.7524954483968331,"v":-7.4787142162116371},{"values":[971.46170383194294,9.669096860277989],"time":"2015-07-03 01","x":120.40963662710507,"y":40.713579035461805,"u":-2.8113046316575412,"v":-7.7421921071583117},{"values":[966.64353733666314,6.9324151647978054],"time":"2015-07-03 00","x":120.52395107727342,"y":40.985947747328822,"u":-2.5196273806820604,"v":-9.087454996586402}]},{"zlevel":3,"grdCollection":[{"values":[942.999434175744,23.435757627930627],"time":"2015-07-03 23","x":114.35409,"y":37.9097,"u":-7.8322477041190908,"v":7.4155279318662988},{"values":[964.04718912645114,19.869633304307154],"time":"2015-07-03 22","x":114.72093600758694,"y":37.704043887792814,"u":-10.098037448649931,"v":5.2541127230178768},{"values":[970.9331269529074,19.500150315642514],"time":"2015-07-03 21","x":115.14040927454843,"y":37.579935701662315,"u":-10.438741050050863,"v":2.3670070459676809},{"values":[971.56886501548684,18.942008666664737],"time":"2015-07-03 20","x":115.54363899572675,"y":37.550015396060843,"u":-9.3106990746795777,"v":-0.56098836016502274},{"values":[970.73650476609373,18.348586617317856],"time":"2015-07-03 19","x":115.87931996596713,"y":37.584937245973968,"u":-7.1226385015681091,"v":-1.6257322464952815},{"values":[971.08758660737624,18.442769727656131],"time":"2015-07-03 18","x":116.1490409021654,"y":37.655051274031237,"u":-6.0691766021941165,"v":-2.7246633487116942},{"values":[971.44910747675976,18.79279092319123],"time":"2015-07-03 17","x":116.39159519637982,"y":37.756537372771604,"u":-5.7777153087760711,"v":-3.5601926435474729},{"values":[972.054290714942,17.0412929754116],"time":"2015-07-03 16","x":116.62089305093734,"y":37.878654700252248,"u":-5.4031947240133649,"v":-3.99758302275335},{"values":[973.01902247091107,16.972048651771157],"time":"2015-07-03 15","x":116.84353273658809,"y":38.00717479770524,"u":-5.4340836870542928,"v":-3.9549649622793184},{"values":[973.68120555925577,16.861164519960628],"time":"2015-07-03 14","x":117.07326389102788,"y":38.135451725877481,"u":-5.7287878000702248,"v":-3.9834131689212189},{"values":[974.40065292809334,13.621549176088447],"time":"2015-07-03 13","x":117.3242285622639,"y":38.2579072436738,"u":-6.44534878545359,"v":-3.5980231464795631},{"values":[974.72802386039064,10.365099845402737],"time":"2015-07-03 12","x":117.61283690517358,"y":38.374340788047242,"u":-7.6054678576628421,"v":-4.0611650542493942},{"values":[975.00228046250527,8.4621266127218711],"time":"2015-07-03 11","x":117.95518111706377,"y":38.507203758637466,"u":-8.9442799862411917,"v":-4.1774579827074527},{"values":[974.98567198736214,7.7891660269638248],"time":"2015-07-03 10","x":118.33891614016642,"y":38.656072401178278,"u":-9.5679805861274154,"v":-5.0578663628325184},{"values":[974.52514684744835,8.1131268343582423],"time":"2015-07-03 09","x":118.72780499199504,"y":38.834580165186672,"u":-9.1460758526772352,"v":-6.0095621796772649},{"values":[974.04891628118969,8.444697999517393],"time":"2015-07-03 08","x":119.09426920104198,"y":39.045223360182334,"u":-8.4365699944799744,"v":-7.0386942441677105},{"values":[974.32889907159824,7.8094509394978848],"time":"2015-07-03 07","x":119.43706672221978,"y":39.28547451700144,"u":-7.9545024661260868,"v":-7.8342858471804684},{"values":[973.03408221965651,6.7980477494027793],"time":"2015-07-03 06","x":119.73903007805373,"y":39.556715920708577,"u":-6.42799864593267,"v":-8.9462872481977982},{"values":[969.66311591585816,6.5903571763551856],"time":"2015-07-03 05","x":119.96258658499777,"y":39.857010357840828,"u":-4.1737634492146212,"v":-9.61825579041325},{"values":[962.79153228786481,6.2959698071648482],"time":"2015-07-03 04","x":120.10576468172106,"y":40.166738415983929,"u":-2.5854617332894936,"v":-9.5212942526535755},{"values":[955.671010866072,5.9521749433344144],"time":"2015-07-03 03","x":120.19823273658406,"y":40.474293301442,"u":-1.7599771461937002,"v":-9.48084576025266},{"values":[948.46000982942621,5.4301035128463626],"time":"2015-07-03 02","x":120.26355580530203,"y":40.778711792885851,"u":-1.2958506722744931,"v":-9.32640328009309},{"values":[941.82009982142517,4.7176210046750366],"time":"2015-07-03 01","x":120.30918900862893,"y":41.095292948546707,"u":-0.82867614816191337,"v":-10.231641152653985},{"values":[933.98657549391874,4.7203477002887455],"time":"2015-07-03 00","x":120.33823601419016,"y":41.433872791584022,"u":-0.51665823397222377,"v":-10.685092876500837}]}]}];

				// OpenLayers 的 地图
				var map = new ol.Map({
					layers: [
						new ol.layer.Tile({
							source: new ol.source.OSM()
						})
					],
					target: "map",
					controls: ol.control.defaults().extend([
						new ol.control.ScaleLine()
					]),
					view: new ol.View({
						projection: "EPSG:3857",
						zoom: 9,
						center: ol.proj.fromLonLat([116, 38.2])
					})
				});

				// 反向轨迹
				var rd = [];
				rd.push({"code":1001});
				rd[0].result = [];
				for (var k=0; k<data[0].result.length; k++) {
					rd[0].result.push({"zlevel":k+1});
					var g = data[0].result[k].grdCollection;
					var i = g.length-1;
					var a = [];
					for (i; i>=0; i--) {
						a.push(g[i]);
					}
					rd[0].result[k].grdCollection = a;
				}

				// 生成轨迹
				var title = document.createElement("div");
				title.className = "title";
				ob = new LZR.HTML5.Bp.OpenLayers.Orbit ({
					map: map,
					data: data[0].result,
					showNode: 0,
					orbitColor: ["red", "green", "blue"],
					orbitShadowColor: ["red", "green", "blue"],
					orbitAnimationColor: ["white", "white", "white"],
					nodeMin : 6,
					nodeMax : 8,
					orbitBlur : 20,
					orbitSpeed:0.01,
					sourceColor: "yellow",
					titleArea: 3,
					title: title
				});
				ob.onShowTitle = function (div, data, i, j) {
					div.innerHTML = i + " , " + j + " : " + data.time;
				};
				ob.init();

				// 三秒后切换数据
				setTimeout (function () {
					ob.initData (null);
					ob.setVisible(0, true);
					setTimeout (function () {
						ob.setShowNode (2);
						ob.initData (rd[0].result);
						ob.setVisible(0, true);
					}, 3000);
				}, 3000);
/*
多站点的，新的测试数据：
	http://localhost/NaqpmsREST/api/Grd/GetTimeTrajectory?points=116.17%2C40.2865%3B116.434%2C39.9522%3B116.434%2C39.8745&codes=&model=naqpms&isAverage=true&pTime=2015-07-03%2000&cTime=2015-07-03%2000&prediction=1&zlevels=[1%2C2%2C3]&forward=true
*/
				// 生成选择按钮
 				var s = new LZR.HTML5.Util.Selector ({
 					data:[
 						{
							title: "轨迹1",
							pic: "",
							checked: true
						},
						{
							title: "轨迹2",
							pic: "",
							checked: true
						},
 						{
							title: "轨迹3",
							pic: "",
							checked: true
						}
 					],
 					type: 5,
 					checked: 2,
 					defaultClass: "def",
 					downClass: "down",
 					rowNum: 0
 				});
 				s.onDown = function(d, i) {
 					ob.setVisible (i, d[i].checked);
 				}
 				document.body.appendChild(s.div);
			}
		</script>
	</head>

	<body onload="init()">
		<div id="map" class="map"></div>
	</body>
</html> 
