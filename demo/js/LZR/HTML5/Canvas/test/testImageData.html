<html>
	<head>
		<title>画布 ImageData 测试</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style type="text/css">
			.cav {
				width: 100%;
				height: 100%;
				background-color: yellow;
			}
		</style>

		<script>
			function init() {
				var t = new Date().valueOf();
				var ctx =canvas.getContext("2d");
				var w = canvas.clientWidth;
				var h = canvas.clientHeight;
				var d = ctx.createImageData(w,h);
				var b = 1;

				// canvas.width = w;
				// canvas.height = h;

				// d.data[80] = 255;
				// d.data[81] = 0;
				// d.data[82] = 0;
				// d.data[83] = 255;

				// d.data[84] = 0;
				// d.data[85] = 255;
				// d.data[86] = 0;
				// d.data[87] = 255;

				// d.data[88] = 0;
				// d.data[89] = 0;
				// d.data[90] = 255;
				// d.data[91] = 255;

				// ctx.clearRect(0,0,w,h);

				for (var i=0; i<h; i+=b) {
					for (var j=0; j<w; j+=b) {
						var bi = (i*w + j);
						var cr = Math.floor(Math.random() * 255);
						var cg = Math.floor(Math.random() * 255);
						var cb= Math.floor(Math.random() * 255);
						var ca = Math.floor(Math.random() * 255);
						// var cr = 0;
						// var cg = 0;
						// var cb= 0;
						// var ca = 255;

						var nb = b;
						if (b+j>w) {
							nb = w-j;
						}

						for (var m=0; m<b; m++) {
							for (var n=0; n<nb; n++) {
								var k = (bi + m*w + n)*4;
								d.data[k+0]=cr;
								d.data[k+1]=cg;
								d.data[k+2]=cb;
								d.data[k+3]=ca;
							}
						}

					}
				}
				ctx.putImageData(d, 0, 0);

				// 用方块法描画
				// for (var i=0; i<w; i++) {
				// 	for (var j=0; j<h; j++) {
				// 		// ctx.fillStyle="rgba(" + Math.floor(Math.random() * 255) + ", " + Math.floor(Math.random() * 255) + ", " + Math.floor(Math.random() * 255) + ", 1)";
				// 		ctx.fillRect(i,j,1,1);
				// 	}
				// }
alert(new Date().valueOf()-t);
			}
		</script>
	</head>

	<body onload="init()" style="margin:0">
		<canvas id="canvas" class="cav">
			<p>Your browserdoes not support the canvas element!</p>
		</canvas>
	</body>
</html>  